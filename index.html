<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapTakeoff Prime</title>
    <link rel="icon" href="/favicon.ico">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        /* --- CORE STYLES --- */
        body { 
            background-color: #f9fafb; 
            font-family: 'Helvetica Neue', sans-serif; 
            margin: 0; 
            color: #1f2937; 
        }

        .highlight { color: #FFC107; } 

        /* --- NAVIGATION --- */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            padding: 20px 40px;
            background-color: #0a0e17; 
            border-bottom: 1px solid #1f2937;
        }
        .logo { font-size: 24px; font-weight: 800; color: white; text-decoration: none; }

        /* --- HERO BAND --- */
        .hero-band {
            background-color: #0a0e17; 
            text-align: center;
            padding: 80px 20px;
            width: 100%;
            border-bottom: 4px solid #FFC107;
        }
        .hero-band h1 {
            font-size: 3.5rem;
            color: white; 
            margin-bottom: 20px;
            line-height: 1.2;
            margin-top: 0;
        }
        .hero-band p {
            font-size: 1.2rem;
            color: #c9d1d9; 
            max-width: 600px;
            margin: 0 auto 40px auto;
        }
        .btn-cta {
            background-color: #FFC107;
            color: #0a0e17;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 800;
            border-radius: 50px;
            text-decoration: none;
            display: inline-block;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }
        .btn-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 193, 7, 0.6);
            background-color: #ffb300;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        /* --- FEATURES GRID --- */
        .features {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
            margin-bottom: 60px;
        }
        .feature-card {
            background: #ffffff; 
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e5e7eb; 
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
        }
        .feature-icon { font-size: 40px; margin-bottom: 20px; display: block; }
        .feature-title { font-size: 18px; color: #1f2937; font-weight: bold; margin-bottom: 10px; } 
        .feature-desc { font-size: 14px; color: #6b7280; line-height: 1.6; } 

        /* --- FAQ SECTION --- */
        .faq-section { margin-top: 60px; }
        .faq-section h2 { text-align: center; font-size: 2rem; margin-bottom: 40px; color: #1f2937; }
        .faq-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .faq-q { font-weight: bold; font-size: 18px; color: #1f2937; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;}
        .faq-a { color: #6b7280; line-height: 1.5; font-size: 15px; margin-left: 28px; }

        /* --- TOOL PAGE INFO SECTION --- */
        .info-section { margin-bottom: 30px; }
        .info-section h2 {
            text-align: left; 
            color: #1f2937;
            font-size: 1.5rem;
            margin-bottom: 20px;
            margin-top: 0;
            border-bottom: 2px solid #FFC107;
            display: inline-block;
            padding-bottom: 5px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .info-card {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #FFC107;
            border-top: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .info-head { font-size: 15px; font-weight: bold; color: #1f2937; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .info-body { font-size: 13px; color: #6b7280; line-height: 1.4; }

        /* --- BOX STYLES --- */
        .box-dark {
            background-color: #161b22; 
            border: 1px solid #FFC107; 
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.15); 
            border-radius: 12px; 
            padding: 40px; 
            color: white; 
            margin-bottom: 30px;
        }
        .box-dark h2 { color: #FFC107; font-family: 'Courier New', monospace; margin-top: 0; }
        .box-dark .slider-label { color: #8b949e; }
        .box-dark input[type=number], .box-dark select { 
            background-color: #0d1117; 
            border: 1px solid #30363d; 
            color: #FFC107; 
        }
        .box-dark .custom-file-upload {
            background-color: rgba(255, 193, 7, 0.05); 
            color: #FFC107; 
            border: 2px dashed #FFC107;
        }
        .box-dark .custom-file-upload:hover { background-color: rgba(255, 193, 7, 0.15); }
        .box-dark .file-name-display { color: #8b949e; }
        .box-dark hr { border-color: #30363d; }
        .box-dark canvas { border: 1px solid #30363d; cursor: crosshair; }

        .box-dark .metric-box {
            background: #0d1117;
            border: 1px solid #30363d;
        }
        .box-dark .metric-label { color: #8b949e; }
        .box-dark .calib-input {
            background-color: #0d1117; 
            color: #FFC107; 
            border-color: #30363d;
        }

        h1.page-title { color: #1f2937; margin-top: 0; font-size: 3rem; text-align: center; margin-bottom: 30px;}
        .slider-row { display: flex; align-items: center; gap: 15px; }
        .slider-container { flex-grow: 1; margin-bottom: 15px; }
        .slider-label { display: block; font-size: 14px; margin-bottom: 5px; }
        
        input[type=range] { width: 100%; cursor: pointer; accent-color: #FFC107; } 
        input[type="file"] { display: none; }
        
        .custom-file-upload {
            padding: 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
            width: 100%;
            box-sizing: border-box; 
        }
        .file-name-display { display: block; text-align: center; margin-top: 10px; font-size: 13px; font-family: monospace; }

        .btn-upload { background-color: #FFC107; color: #0a0e17; border: none; padding: 15px; border-radius: 6px; font-weight: 800; font-size: 16px; cursor: pointer; width: 100%; margin-top: 20px; transition: 0.3s;}
        .btn-upload:hover { background-color: #ffb300; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3); }

        .results-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px; }
        .metric-box { padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 10px; }
        .metric-val { font-size: 24px; color: #FFC107; font-family: monospace; font-weight: bold; } 
        .calib-input { width: 80px; font-size: 18px; padding: 8px; text-align: center; font-weight: bold; border-radius: 5px; border-style: solid; border-width: 1px; }

        .btn-pay {
            background-color: #FFC107; color: #0a0e17; border: none; padding: 15px;
            width: 100%; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 10px;
            font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-pay:hover { background-color: #ffb300; }
        
        .btn-free {
            background-color: transparent; color: #b48a00; border: 2px solid #FFC107; padding: 15px;
            width: 100%; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 20px;
            font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.3s;
        }
        .btn-free:hover { background-color: #FFC107; color: #0a0e17; }
        
        /* New Tools Buttons */
        .tool-row { display: flex; gap: 10px; margin-top: 10px; }
        .btn-tool-toggle {
            background: #0d1117; color: #8b949e; border: 1px solid #30363d; padding: 10px 20px;
            cursor: pointer; border-radius: 6px; font-weight: bold; width: 100%;
        }
        .btn-tool-toggle.active { background: #FFC107; color: #0a0e17; border-color: #FFC107; }
        .btn-tool-clear { background: #21262d; color: #f85149; border: 1px solid #30363d; }

        .hidden { display: none !important; }

        .footer { text-align: center; margin-top: 80px; padding: 40px 0; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px; }
        .footer a { color: #FFC107; text-decoration: none; font-weight: bold;}
    </style>
    
    <script>
        function syncInputs(sourceId, targetId) { document.getElementById(targetId).value = document.getElementById(sourceId).value; }
        
        function updateFileName(input) {
            const fileNameDisplay = document.getElementById('file-name-text');
            if (input.files && input.files.length > 0) {
                fileNameDisplay.innerText = "üìÑ " + input.files[0].name;
                fileNameDisplay.style.color = '#FFC107'; 
            } else {
                fileNameDisplay.innerText = "No file chosen yet.";
            }
        }

        function checkFreeTrial() {
            const used = localStorage.getItem('snaptakeoff_trial_used');
            if (used && document.getElementById('btn-free')) {
                document.getElementById('btn-free').classList.add('hidden');
            }
        }

        function useFreeTrial() {
            if(confirm("üéÅ Use your 1-time FREE UNLOCK now?")) {
                localStorage.setItem('snaptakeoff_trial_used', 'true');
                document.getElementById('btn-free').classList.add('hidden');
                document.getElementById('download_form').submit();
            }
        }

        function startPayment() {
            var options = {
                "key": "rzp_test_YOUR_KEY_HERE", 
                "amount": "19900", 
                "currency": "INR",
                "name": "SnapTakeoff Pro",
                "description": "Unlock Excel Estimate",
                "image": "/favicon.ico",
                "handler": function (response){
                    document.getElementById('download_form').submit();
                },
                "theme": { "color": "#FFC107" } 
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
            return false;
        }

        // --- CANVAS TOOLS LOGIC ---
        let areaPoints = [];
        let countPoints = [];
        let mode = 'none'; // 'none', 'area', 'count'
        let canvas, ctx, bgImage;

        function initCanvas(imgDataStr) {
            canvas = document.getElementById('blueprintCanvas');
            ctx = canvas.getContext('2d');
            
            bgImage = new Image();
            bgImage.onload = function() {
                canvas.width = bgImage.width;
                canvas.height = bgImage.height;
                redrawCanvas();
            };
            bgImage.src = "data:image/jpeg;base64," + imgDataStr;

            canvas.addEventListener('mousedown', function(e) {
                if (mode === 'none') return;
                
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;

                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                if (mode === 'area') {
                    areaPoints.push({x: x, y: y});
                    calcArea(); // Calc math immediately
                } else if (mode === 'count') {
                    countPoints.push({x: x, y: y});
                    updateCountDisplay(); // Update count immediately
                }
                
                redrawCanvas();
            });
        }

        function setMode(newMode) {
            mode = (mode === newMode) ? 'none' : newMode; // Toggle off if clicked again
            
            // UI Updates
            document.getElementById('btnAreaMode').classList.remove('active');
            document.getElementById('btnCountMode').classList.remove('active');
            
            if (mode === 'area') document.getElementById('btnAreaMode').classList.add('active');
            if (mode === 'count') document.getElementById('btnCountMode').classList.add('active');
        }

        function clearTools() {
            if(confirm("Clear all drawings and counts?")) {
                areaPoints = [];
                countPoints = [];
                mode = 'none';
                document.getElementById('btnAreaMode').classList.remove('active');
                document.getElementById('btnCountMode').classList.remove('active');
                document.getElementById('display_area').innerText = "---";
                document.getElementById('display_count').innerText = "---";
                redrawCanvas();
            }
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(bgImage, 0, 0);

            // 1. Draw Area Polygon
            if (areaPoints.length > 0) {
                ctx.beginPath();
                ctx.moveTo(areaPoints[0].x, areaPoints[0].y);
                for (let i = 1; i < areaPoints.length; i++) {
                    ctx.lineTo(areaPoints[i].x, areaPoints[i].y);
                }
                ctx.closePath();
                ctx.fillStyle = "rgba(255, 193, 7, 0.3)"; 
                ctx.fill();
                ctx.lineWidth = 4;
                ctx.strokeStyle = "#FFC107";
                ctx.stroke();

                // Vertices
                ctx.fillStyle = "red";
                for (let p of areaPoints) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // 2. Draw Count Markers
            ctx.fillStyle = "#00BFFF"; // Deep Sky Blue
            ctx.strokeStyle = "white";
            ctx.lineWidth = 2;
            for (let p of countPoints) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }
        }

        function calcArea() {
            if (areaPoints.length < 3) return;
            // Shoelace Formula
            let areaPx = 0;
            for (let i = 0; i < areaPoints.length; i++) {
                let j = (i + 1) % areaPoints.length;
                areaPx += areaPoints[i].x * areaPoints[j].y;
                areaPx -= areaPoints[j].x * areaPoints[i].y;
            }
            areaPx = Math.abs(areaPx) / 2;

            const rawWidth = parseFloat(document.getElementById('raw_width_store').value);
            let realFt = parseFloat(document.getElementById('real_width_input').value);
            if (!realFt || realFt <= 0) realFt = 1;

            const scale = rawWidth / realFt; 
            const areaSqFt = areaPx / (scale * scale);

            document.getElementById('display_area').innerText = areaSqFt.toFixed(2) + " sq.ft";
            
            // Send to Hidden Input
            document.getElementById('hidden_area').value = areaSqFt.toFixed(2);
        }

        function updateCountDisplay() {
            const count = countPoints.length;
            document.getElementById('display_count').innerText = count + " items";
            // Send to Hidden Input
            document.getElementById('hidden_count').value = count;
        }

        function recalc() {
            try {
                if(areaPoints.length >= 3) calcArea();
                updateCountDisplay();

                const rawPixels = parseFloat(document.getElementById('raw_pixels_store').value);
                const rawWidth = parseFloat(document.getElementById('raw_width_store').value);
                
                let realFt = parseFloat(document.getElementById('real_width_input').value);
                if (!realFt || realFt <= 0) realFt = 1;

                let pricePerSheet = parseFloat(document.getElementById('cost_sheet').value) || 15;
                let pricePerPaint = parseFloat(document.getElementById('cost_paint').value) || 40;
                let pricePerItem = parseFloat(document.getElementById('cost_item').value) || 50; 
                
                let currencySym = document.getElementById('currency_select').value;

                // Math
                const scale = rawWidth / realFt; 
                const totalFeet = rawPixels / scale;
                const sheets = (totalFeet * 8) / 32;
                
                const costDrywall = sheets * pricePerSheet;
                const paint = (totalFeet * 8) / 400;
                const costPaint = paint * pricePerPaint;
                const costItems = countPoints.length * pricePerItem; 
                
                const totalCost = costDrywall + costPaint + costItems;
                
                document.getElementById('display_feet').innerText = totalFeet.toFixed(2) + " ft";
                document.getElementById('display_cost').innerText = currencySym + totalCost.toFixed(2);
                
                document.getElementById('hidden_feet').value = totalFeet.toFixed(2);
                document.getElementById('hidden_cost').value = totalCost.toFixed(2);
                document.getElementById('hidden_sheets').value = sheets;
                document.getElementById('hidden_paint').value = paint;
                
                document.getElementById('hidden_currency').value = currencySym;
                document.getElementById('hidden_unit_sheet').value = pricePerSheet;
                document.getElementById('hidden_unit_paint').value = pricePerPaint;
                document.getElementById('hidden_unit_item').value = pricePerItem;
                
                checkFreeTrial();
            } catch(e) {}
        }
    </script>
</head>
<body onload="checkFreeTrial()">

    <div class="navbar">
        <a href="/" class="logo">Snap<span class="highlight">Takeoff</span></a>
    </div>

    {% if page == 'home' %}
        <div class="hero-band">
            <h1>AI Estimation for<br><span class="highlight">Modern Contractors</span></h1>
            <p>Upload your blueprint. Get instant material takeoffs and cost estimates. No complex software required.</p>
            <a href="/tool" class="btn-cta">GET STARTED</a>
        </div>
        <div class="container">
            <div class="features">
                <div class="feature-card">
                    <span class="feature-icon">üìÇ</span>
                    <div class="feature-title">1. Upload Blueprint</div>
                    <div class="feature-desc">Simply upload an image of your floor plan (JPG or PNG). No CAD files needed.</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ü§ñ</span>
                    <div class="feature-title">2. AI Analysis</div>
                    <div class="feature-desc">Our intelligent sensor detects walls and calculates linear footage automatically.</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <div class="feature-title">3. Instant Excel</div>
                    <div class="feature-desc">Download a professional cost estimate and material list in seconds.</div>
                </div>
            </div>
            
             <div class="faq-section">
                <h2>Frequently Asked Questions</h2>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> How accurate is the estimation?</div>
                    <div class="faq-a">The accuracy depends on the image clarity and your calibration. If you set the "Real World Width" correctly, SnapTakeoff is typically accurate within 95-98% for linear footage.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> What file formats do you accept?</div>
                    <div class="faq-a">We accept standard image files like .JPG, .JPEG, and .PNG. If you have a PDF, please take a screenshot of the page you want to estimate and upload that.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> Is my payment information secure?</div>
                    <div class="faq-a">Yes. We use Razorpay, a banking-grade payment processor. We do not store your card details on our servers.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> Can I customize material prices?</div>
                    <div class="faq-a">Absolutely. After scanning, you can enter your own local prices for Drywall Sheets and Paint to get an exact quote for your specific job.</div>
                </div>
            </div>
            <div class="footer">
                <p>Have questions? Email us at <a href="mailto:filehangar2025@gmail.com">filehangar2025@gmail.com</a></p>
                <p style="opacity: 0.7; margin-top: 10px;">&copy; 2024 SnapTakeoff Inc.</p>
            </div>
        </div>
    {% endif %}

    {% if page == 'tool' %}
        <div class="container">
            <h1 class="page-title">Upload Blueprint.</h1>
            
            <div class="info-section">
                <h2>Controls Guide</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">‚ö°</span> Sensitivity</div>
                        <div class="info-body">Lower = More sensitive (detects faint lines). Higher = Less sensitive (bold lines only).</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üåâ</span> Gap Fill</div>
                        <div class="info-body">Connects broken lines. Increase this to jump gaps like doorways.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üßπ</span> Min Wall Length</div>
                        <div class="info-body">Noise filter. Ignores small specks, text, or furniture.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üìè</span> Wall Thickness</div>
                        <div class="info-body">Visual only. Makes the red lines thicker for easier viewing.</div>
                    </div>
                    <div class="info-card" style="grid-column: 1 / -1;">
                        <div class="info-head"><span class="highlight">üéØ</span> Real World Width (Important)</div>
                        <div class="info-body">After scanning, enter the total width of the image in Feet. The AI uses this to calculate cost.</div>
                    </div>
                </div>
            </div>

            <div class="box-dark">
                <h2>// SENSOR CONFIGURATION</h2>
                <form action="/tool" method="post" enctype="multipart/form-data">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <div class="slider-container"><label class="slider-label">Sensitivity</label><div class="slider-row"><input type="range" id="range_thresh" name="thresh" min="20" max="200" value="{{ params.thresh }}" oninput="syncInputs('range_thresh', 'num_thresh')"><input type="number" id="num_thresh" min="20" max="200" value="{{ params.thresh }}" oninput="syncInputs('num_thresh', 'range_thresh')"></div></div>
                            <div class="slider-container"><label class="slider-label">Min Wall Length</label><div class="slider-row"><input type="range" id="range_len" name="min_len" min="50" max="500" value="{{ params.min_len }}" oninput="syncInputs('range_len', 'num_len')"><input type="number" id="num_len" min="50" max="500" value="{{ params.min_len }}" oninput="syncInputs('num_len', 'range_len')"></div></div>
                        </div>
                        <div>
                            <div class="slider-container"><label class="slider-label">Gap Fill</label><div class="slider-row"><input type="range" id="range_gap" name="gap" min="5" max="100" value="{{ params.gap }}" oninput="syncInputs('range_gap', 'num_gap')"><input type="number" id="num_gap" min="5" max="100" value="{{ params.gap }}" oninput="syncInputs('num_gap', 'range_gap')"></div></div>
                            <div class="slider-container"><label class="slider-label">Wall Thickness</label><div class="slider-row"><input type="range" id="range_thick" name="thick" min="1" max="10" value="{{ params.thick }}" oninput="syncInputs('range_thick', 'num_thick')"><input type="number" id="num_thick" min="1" max="10" value="{{ params.thick }}" oninput="syncInputs('num_thick', 'range_thick')"></div></div>
                        </div>
                    </div>
                    <hr>
                    <div style="margin-bottom: 20px;">
                        <label for="file-upload" class="custom-file-upload">üìÇ CLICK TO SELECT BLUEPRINT</label>
                        <input id="file-upload" type="file" name="file" required onchange="updateFileName(this)">
                        <span id="file-name-text" class="file-name-display">No file chosen yet.</span>
                    </div>
                    <button type="submit" class="btn-upload">INITIATE SCAN</button>
                </form>
            </div>

            {% if result %}
            <input type="hidden" id="raw_pixels_store" value="{{ raw_pixels }}">
            <input type="hidden" id="raw_width_store" value="{{ raw_width }}">

            <div class="box-dark">
                <h2 style="color: #FFC107;">// ANALYSIS COMPLETE</h2>
                <div class="results-grid">
                    <div>
                        <canvas id="blueprintCanvas" style="width: 100%; border-radius: 8px;"></canvas>
                        
                        <div class="tool-row">
                            <button id="btnAreaMode" class="btn-tool-toggle" onclick="setMode('area')">üìê AREA (FLOOR)</button>
                            <button id="btnCountMode" class="btn-tool-toggle" onclick="setMode('count')">üëÜ COUNT ITEMS</button>
                            <button class="btn-tool-toggle btn-tool-clear" onclick="clearTools()">üóëÔ∏è RESET</button>
                        </div>
                    </div>
                    <div>
                        <div class="metric-box">
                            <div class="metric-label" style="color: #FFC107; font-weight:bold;">REAL WORLD WIDTH (FT)</div>
                            <input type="number" id="real_width_input" class="calib-input" value="50" oninput="recalc()">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div class="metric-box">
                                <div class="metric-label">COST/SHEET</div>
                                <input type="number" id="cost_sheet" class="calib-input" value="15" oninput="recalc()">
                            </div>
                            <div class="metric-box">
                                <div class="metric-label">COST/PAINT</div>
                                <input type="number" id="cost_paint" class="calib-input" value="40" oninput="recalc()">
                            </div>
                        </div>

                        <div class="metric-box" style="margin-bottom: 10px;">
                            <div class="metric-label">COST PER ITEM</div>
                            <input type="number" id="cost_item" class="calib-input" value="50" oninput="recalc()">
                        </div>

                        <div class="metric-box" style="margin-bottom: 10px;">
                            <div class="metric-label">CURRENCY</div>
                            <select id="currency_select" class="calib-input" style="width: 100%;" onchange="recalc()">
                                <option value="$">USD ($)</option>
                                <option value="‚Çπ">INR (‚Çπ)</option>
                                <option value="‚Ç¨">EUR (‚Ç¨)</option>
                                <option value="¬£">GBP (¬£)</option>
                                <option value="SAR ">SAR (Ô∑º)</option>
                                <option value="AED ">AED (ÿØ.ÿ•)</option>
                                <option value="C$">CAD (C$)</option>
                                <option value="A$">AUD (A$)</option>
                            </select>
                        </div>

                        <div class="metric-box"><div class="metric-val" id="display_feet">---</div><div class="metric-label">TOTAL LINEAR FEET</div></div>
                        <div class="metric-box"><div class="metric-val" id="display_area">---</div><div class="metric-label">FLOOR AREA</div></div>
                        <div class="metric-box"><div class="metric-val" id="display_count">---</div><div class="metric-label">ITEMS COUNTED</div></div>

                        <div class="metric-box"><div class="metric-val" id="display_cost">---</div><div class="metric-label">ESTIMATED COST</div></div>
                        
                        <form id="download_form" action="/download_report" method="post">
                            <input type="hidden" name="final_feet" id="hidden_feet">
                            <input type="hidden" name="final_cost" id="hidden_cost">
                            <input type="hidden" name="final_sheets" id="hidden_sheets">
                            <input type="hidden" name="final_paint" id="hidden_paint">
                            <input type="hidden" name="final_area" id="hidden_area" value="0">
                            <input type="hidden" name="final_count" id="hidden_count" value="0">
                            
                            <input type="hidden" name="currency_symbol" id="hidden_currency">
                            <input type="hidden" name="unit_price_sheet" id="hidden_unit_sheet">
                            <input type="hidden" name="unit_price_paint" id="hidden_unit_paint">
                            <input type="hidden" name="unit_price_item" id="hidden_unit_item">
                            
                            <button type="button" id="btn-free" onclick="useFreeTrial()" class="btn-free">
                                üéÅ UNLOCK FOR FREE (1 TIME ONLY)
                            </button>

                            <button type="button" onclick="startPayment()" class="btn-pay">
                                üîí UNLOCK & DOWNLOAD (‚Çπ199)
                            </button>
                        </form>

                    </div>
                </div>
            </div>
            <script>
                initCanvas("{{ image_data }}");
                recalc();
            </script>
            {% endif %}
        </div>
    {% endif %}
</body>
</html>