<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapTakeoff Prime</title>
    <link rel="icon" href="/favicon.ico">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        /* --- CORE STYLES --- */
        body { 
            background-color: #f9fafb; 
            font-family: 'Helvetica Neue', sans-serif; 
            margin: 0; 
            color: #1f2937; 
        }

        .highlight { color: #FFC107; } 

        /* --- NAVIGATION --- */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            padding: 20px 40px;
            background-color: #0a0e17; 
            border-bottom: 1px solid #1f2937;
        }
        .logo { font-size: 24px; font-weight: 800; color: white; text-decoration: none; }

        /* --- HERO BAND --- */
        .hero-band {
            background-color: #0a0e17; 
            text-align: center;
            padding: 80px 20px;
            width: 100%;
            border-bottom: 4px solid #FFC107;
        }
        .hero-band h1 {
            font-size: 3.5rem;
            color: white; 
            margin-bottom: 20px;
            line-height: 1.2;
            margin-top: 0;
        }
        .hero-band p {
            font-size: 1.2rem;
            color: #c9d1d9; 
            max-width: 600px;
            margin: 0 auto 40px auto;
        }
        .btn-cta {
            background-color: #FFC107;
            color: #0a0e17;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 800;
            border-radius: 50px;
            text-decoration: none;
            display: inline-block;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }
        .btn-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(255, 193, 7, 0.6);
            background-color: #ffb300;
        }

        /* --- WIDENED CONTAINER --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        /* --- FEATURES GRID --- */
        .features {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
            margin-bottom: 60px;
        }
        .feature-card {
            background: #ffffff; 
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e5e7eb; 
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
        }
        .feature-icon { font-size: 40px; margin-bottom: 20px; display: block; }
        .feature-title { font-size: 18px; color: #1f2937; font-weight: bold; margin-bottom: 10px; } 
        .feature-desc { font-size: 14px; color: #6b7280; line-height: 1.6; } 

        /* --- FAQ SECTION --- */
        .faq-section { margin-top: 60px; }
        .faq-section h2 { text-align: center; font-size: 2rem; margin-bottom: 40px; color: #1f2937; }
        .faq-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .faq-q { font-weight: bold; font-size: 18px; color: #1f2937; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;}
        .faq-a { color: #6b7280; line-height: 1.5; font-size: 15px; margin-left: 28px; }

        /* --- TOOL PAGE INFO SECTION --- */
        .info-section { margin-bottom: 30px; }
        .info-section h2 {
            text-align: left; 
            color: #1f2937;
            font-size: 1.5rem;
            margin-bottom: 20px;
            margin-top: 0;
            border-bottom: 2px solid #FFC107;
            display: inline-block;
            padding-bottom: 5px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .info-card {
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #FFC107;
            border-top: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .info-head { font-size: 15px; font-weight: bold; color: #1f2937; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .info-body { font-size: 13px; color: #6b7280; line-height: 1.4; }

        /* --- BOX STYLES --- */
        .box-dark {
            background-color: #161b22; 
            border: 1px solid #FFC107; 
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.15); 
            border-radius: 12px; 
            padding: 40px; 
            color: white; 
            margin-bottom: 30px;
        }
        .box-dark h2 { color: #FFC107; font-family: 'Courier New', monospace; margin-top: 0; }
        .box-dark .slider-label { color: #8b949e; }
        .box-dark input[type=number], .box-dark select { 
            background-color: #0d1117; 
            border: 1px solid #30363d; 
            color: #FFC107; 
        }
        .box-dark .custom-file-upload {
            background-color: rgba(255, 193, 7, 0.05); 
            color: #FFC107; 
            border: 2px dashed #FFC107;
        }
        .box-dark .custom-file-upload:hover { background-color: rgba(255, 193, 7, 0.15); }
        .box-dark .file-name-display { color: #8b949e; }
        .box-dark hr { border-color: #30363d; }
        .box-dark canvas { border: 1px solid #30363d; cursor: crosshair; }

        .box-dark .metric-box {
            background: #0d1117;
            border: 1px solid #30363d;
        }
        .box-dark .metric-label { color: #8b949e; }
        .box-dark .calib-input {
            background-color: #0d1117; 
            color: #FFC107; 
            border-color: #30363d;
        }

        /* --- COMPACT STYLES --- */
        .calib-input-compact {
            width: 100%;
            font-size: 13px;
            padding: 4px 0; 
            text-align: center;
            font-weight: bold;
            border-radius: 5px;
            border: 1px solid #30363d;
            background-color: #0d1117; 
            color: #FFC107;
            box-sizing: border-box; 
            min-width: 0; 
        }
        .metric-box-compact {
            padding: 5px 2px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            text-align: center;
            overflow: hidden;
        }

        h1.page-title { color: #1f2937; margin-top: 0; font-size: 3rem; text-align: center; margin-bottom: 30px;}
        .slider-row { display: flex; align-items: center; gap: 15px; }
        .slider-container { flex-grow: 1; margin-bottom: 15px; }
        .slider-label { display: block; font-size: 14px; margin-bottom: 5px; }
        
        input[type=range] { width: 100%; cursor: pointer; accent-color: #FFC107; } 
        input[type="file"] { display: none; }
        
        .custom-file-upload {
            padding: 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
            width: 100%;
            box-sizing: border-box; 
        }
        .file-name-display { display: block; text-align: center; margin-top: 10px; font-size: 13px; font-family: monospace; }

        .btn-upload { background-color: #FFC107; color: #0a0e17; border: none; padding: 15px; border-radius: 6px; font-weight: 800; font-size: 16px; cursor: pointer; width: 100%; margin-top: 20px; transition: 0.3s;}
        .btn-upload:hover { background-color: #ffb300; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3); }

        .results-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px; }
        .metric-box { padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 10px; }
        .metric-val { font-size: 24px; color: #FFC107; font-family: monospace; font-weight: bold; } 
        .calib-input { width: 80px; font-size: 18px; padding: 8px; text-align: center; font-weight: bold; border-radius: 5px; border-style: solid; border-width: 1px; }

        .btn-pay {
            background-color: #FFC107; color: #0a0e17; border: none; padding: 15px;
            width: 100%; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 10px;
            font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-pay:hover { background-color: #ffb300; }
        
        .btn-free {
            background-color: transparent; color: #b48a00; border: 2px solid #FFC107; padding: 15px;
            width: 100%; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 20px;
            font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.3s;
        }
        .btn-free:hover { background-color: #FFC107; color: #0a0e17; }
        
        /* New Tools Buttons */
        .tool-row { display: flex; gap: 10px; margin-top: 10px; align-items: center; }
        .btn-tool-toggle {
            background: #0d1117; color: #8b949e; border: 1px solid #30363d; padding: 10px 15px;
            cursor: pointer; border-radius: 6px; font-weight: bold; flex-grow: 1;
        }
        .btn-tool-toggle.active { background: #FFC107; color: #0a0e17; border-color: #FFC107; }
        .btn-tool-clear { background: #21262d; color: #f85149; border: 1px solid #30363d; flex-grow: 0;}
        
        .cat-select { padding: 10px; background: #0d1117; color: #FFC107; border: 1px solid #30363d; border-radius: 6px; font-weight: bold; width: 140px;}

        .hidden { display: none !important; }

        .footer { text-align: center; margin-top: 80px; padding: 40px 0; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px; }
        .footer a { color: #FFC107; text-decoration: none; font-weight: bold;}
    </style>
    
    <script>
        function syncInputs(sourceId, targetId) { document.getElementById(targetId).value = document.getElementById(sourceId).value; }
        
        function updateFileName(input) {
            const fileNameDisplay = document.getElementById('file-name-text');
            if (input.files && input.files.length > 0) {
                fileNameDisplay.innerText = "üìÑ " + input.files[0].name;
                fileNameDisplay.style.color = '#FFC107'; 
            } else {
                fileNameDisplay.innerText = "No file chosen yet.";
            }
        }

        function checkFreeTrial() {
            const used = localStorage.getItem('snaptakeoff_trial_used');
            if (used && document.getElementById('btn-free')) {
                document.getElementById('btn-free').classList.add('hidden');
            }
        }

        function useFreeTrial() {
            if(confirm("üéÅ Use your 1-time FREE UNLOCK now?")) {
                localStorage.setItem('snaptakeoff_trial_used', 'true');
                document.getElementById('btn-free').classList.add('hidden');
                document.getElementById('download_form').submit();
            }
        }

        function startPayment() {
            var options = {
                "key": "rzp_test_YOUR_KEY_HERE", 
                "amount": "19900", 
                "currency": "INR",
                "name": "SnapTakeoff Pro",
                "description": "Unlock Excel Estimate",
                "image": "/favicon.ico",
                "handler": function (response){
                    document.getElementById('download_form').submit();
                },
                "theme": { "color": "#FFC107" } 
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
            return false;
        }

        // --- CANVAS TOOLS LOGIC ---
        let areaPoints = [];
        let countPoints = []; 
        let scalePoints = []; 
        let mode = 'none'; 
        let currentCategory = 'elec'; 
        let isLoupeEnabled = true; // DEFAULT ON
        let canvas, ctx, bgImage;
        let mouseX = 0;
        let mouseY = 0;

        function initCanvas(imgDataStr) {
            canvas = document.getElementById('blueprintCanvas');
            ctx = canvas.getContext('2d');
            
            bgImage = new Image();
            bgImage.onload = function() {
                canvas.width = bgImage.width;
                canvas.height = bgImage.height;
                redrawCanvas();
            };
            bgImage.src = "data:image/jpeg;base64," + imgDataStr;

            // Track mouse for Loupe
            canvas.addEventListener('mousemove', function(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                mouseX = (e.clientX - rect.left) * scaleX;
                mouseY = (e.clientY - rect.top) * scaleY;
                redrawCanvas();
            });

            canvas.addEventListener('mousedown', function(e) {
                if (mode === 'none') return;
                
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                if (mode === 'area') {
                    areaPoints.push({x: x, y: y});
                    calcArea(); 
                } else if (mode === 'count') {
                    countPoints.push({x: x, y: y, type: currentCategory});
                    updateCountDisplay(); 
                    recalc(); 
                } else if (mode === 'scale') {
                    scalePoints.push({x: x, y: y});
                    if (scalePoints.length === 2) {
                        redrawCanvas(); 
                        setTimeout(finalizeScale, 50); 
                    }
                }
                
                redrawCanvas();
            });
        }

        function finalizeScale() {
            let ft = prompt("Enter the real-world length of the line you just drew (in Feet):", "3.0");
            if (ft && !isNaN(ft) && parseFloat(ft) > 0) {
                let p1 = scalePoints[0];
                let p2 = scalePoints[1];
                let distPx = Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
                let knownFt = parseFloat(ft);
                let pxPerFt = distPx / knownFt;
                
                let rawWidth = parseFloat(document.getElementById('raw_width_store').value);
                let totalWidthFt = rawWidth / pxPerFt;
                
                document.getElementById('real_width_input').value = totalWidthFt.toFixed(2);
                alert(`‚úÖ Scale Calibrated!\nWe calculated ${pxPerFt.toFixed(2)} pixels per foot.`);
                recalc(); 
            } else {
                alert("Scale calibration cancelled.");
            }
            scalePoints = [];
            setMode('none');
            redrawCanvas();
        }

        function setMode(newMode) {
            mode = (mode === newMode) ? 'none' : newMode; 
            if (mode !== 'scale') scalePoints = [];

            document.getElementById('btnAreaMode').classList.remove('active');
            document.getElementById('btnCountMode').classList.remove('active');
            document.getElementById('btnScaleMode').classList.remove('active');
            document.getElementById('catSelector').classList.add('hidden'); 
            
            // Cursor logic
            if (mode === 'none') canvas.style.cursor = 'default';
            else if (mode === 'count') canvas.style.cursor = 'crosshair';
            else canvas.style.cursor = 'none'; // Hide cursor if loupe might be active

            if (mode === 'area') document.getElementById('btnAreaMode').classList.add('active');
            if (mode === 'count') {
                document.getElementById('btnCountMode').classList.add('active');
                document.getElementById('catSelector').classList.remove('hidden'); 
            }
            if (mode === 'scale') document.getElementById('btnScaleMode').classList.add('active');
            
            redrawCanvas();
        }

        function toggleLoupe() {
            isLoupeEnabled = !isLoupeEnabled;
            const btn = document.getElementById('btnLoupeToggle');
            if (isLoupeEnabled) {
                btn.classList.add('active');
                btn.innerText = "üîç ZOOM: ON";
            } else {
                btn.classList.remove('active');
                btn.innerText = "üîç ZOOM: OFF";
                // Restore cursor if we are in a mode that hides it
                if (mode === 'area' || mode === 'scale') canvas.style.cursor = 'crosshair';
            }
            redrawCanvas();
        }

        function updateCategory() {
            currentCategory = document.getElementById('catSelector').value;
        }

        function clearTools() {
            if(confirm("Clear all drawings and counts?")) {
                areaPoints = [];
                countPoints = [];
                scalePoints = [];
                mode = 'none';
                canvas.style.cursor = 'default';
                document.getElementById('btnAreaMode').classList.remove('active');
                document.getElementById('btnCountMode').classList.remove('active');
                document.getElementById('btnScaleMode').classList.remove('active');
                document.getElementById('catSelector').classList.add('hidden');
                document.getElementById('display_area').innerText = "---";
                document.getElementById('display_count').innerText = "---";
                redrawCanvas();
                recalc();
            }
        }

        function redrawCanvas() {
            if(!ctx) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(bgImage, 0, 0);

            // 1. Draw Area Polygon
            if (areaPoints.length > 0) {
                ctx.beginPath();
                ctx.moveTo(areaPoints[0].x, areaPoints[0].y);
                for (let i = 1; i < areaPoints.length; i++) {
                    ctx.lineTo(areaPoints[i].x, areaPoints[i].y);
                }
                ctx.closePath();
                ctx.fillStyle = "rgba(255, 193, 7, 0.3)"; 
                ctx.fill();
                ctx.lineWidth = 4;
                ctx.strokeStyle = "#FFC107";
                ctx.stroke();

                ctx.fillStyle = "red";
                for (let p of areaPoints) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // 2. Draw Count Markers
            ctx.lineWidth = 2;
            ctx.strokeStyle = "white";
            for (let p of countPoints) {
                ctx.beginPath();
                if (p.type === 'elec') ctx.fillStyle = "#00FFFF"; 
                else if (p.type === 'plumb') ctx.fillStyle = "#FF4500"; 
                else if (p.type === 'hvac') ctx.fillStyle = "#32CD32"; 
                else ctx.fillStyle = "#00BFFF"; 

                ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
            }

            // 3. Draw Scale Line
            if (scalePoints.length > 0) {
                ctx.strokeStyle = "#FF00FF"; 
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(scalePoints[0].x, scalePoints[0].y);
                if (scalePoints.length > 1) {
                    ctx.lineTo(scalePoints[1].x, scalePoints[1].y);
                }
                ctx.stroke();
                ctx.fillStyle = "#FF00FF";
                for(let p of scalePoints) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // 4. DRAW MAGNIFYING GLASS (LOUPE)
            // Checked against toggle AND mode
            if (isLoupeEnabled && (mode === 'area' || mode === 'scale')) {
                // Ensure cursor is hidden so loupe is visible without obstruction
                canvas.style.cursor = 'none';

                const zoom = 4;
                const r = 75; // Radius of loupe
                
                ctx.save();
                ctx.beginPath();
                ctx.arc(mouseX, mouseY, r, 0, Math.PI * 2);
                ctx.clip();
                
                ctx.fillStyle = "white";
                ctx.fillRect(mouseX - r, mouseY - r, r * 2, r * 2);

                ctx.drawImage(
                    bgImage, 
                    mouseX - r/zoom, mouseY - r/zoom, (r*2)/zoom, (r*2)/zoom, 
                    mouseX - r, mouseY - r, r*2, r*2
                );
                
                ctx.strokeStyle = "#00FFFF"; 
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(mouseX - 10, mouseY);
                ctx.lineTo(mouseX + 10, mouseY);
                ctx.moveTo(mouseX, mouseY - 10);
                ctx.lineTo(mouseX, mouseY + 10);
                ctx.stroke();

                ctx.restore();

                ctx.beginPath();
                ctx.arc(mouseX, mouseY, r, 0, Math.PI * 2);
                ctx.lineWidth = 3;
                ctx.strokeStyle = "white";
                ctx.stroke();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "black";
                ctx.stroke();
            } else {
                // If Loupe is OFF but we are in a drawing mode, ensure crosshair is visible
                if (mode === 'area' || mode === 'scale') {
                    canvas.style.cursor = 'crosshair';
                }
            }
        }

        function calcArea() {
            if (areaPoints.length < 3) return;
            let areaPx = 0;
            for (let i = 0; i < areaPoints.length; i++) {
                let j = (i + 1) % areaPoints.length;
                areaPx += areaPoints[i].x * areaPoints[j].y;
                areaPx -= areaPoints[j].x * areaPoints[i].y;
            }
            areaPx = Math.abs(areaPx) / 2;

            const rawWidth = parseFloat(document.getElementById('raw_width_store').value);
            let realFt = parseFloat(document.getElementById('real_width_input').value);
            if (!realFt || realFt <= 0) realFt = 1;

            const scale = rawWidth / realFt; 
            const areaSqFt = areaPx / (scale * scale);

            document.getElementById('display_area').innerText = areaSqFt.toFixed(2) + " sq.ft";
            document.getElementById('hidden_area').value = areaSqFt.toFixed(2);
        }

        function updateCountDisplay() {
            const count = countPoints.length;
            document.getElementById('display_count').innerText = count + " total";
        }

        function recalc() {
            try {
                if(areaPoints.length >= 3) calcArea();
                updateCountDisplay();

                const rawPixels = parseFloat(document.getElementById('raw_pixels_store').value);
                const rawWidth = parseFloat(document.getElementById('raw_width_store').value);
                
                let realFt = parseFloat(document.getElementById('real_width_input').value);
                if (!realFt || realFt <= 0) realFt = 1;

                let pricePerSheet = parseFloat(document.getElementById('cost_sheet').value) || 15;
                let pricePerPaint = parseFloat(document.getElementById('cost_paint').value) || 40;
                
                // New Category Costs
                let costElecUnit = parseFloat(document.getElementById('cost_elec').value) || 5;
                let costPlumbUnit = parseFloat(document.getElementById('cost_plumb').value) || 150;
                let costHvacUnit = parseFloat(document.getElementById('cost_hvac').value) || 80;
                
                let currencySym = document.getElementById('currency_select').value;

                // Math
                const scale = rawWidth / realFt; 
                const totalFeet = rawPixels / scale;
                const sheets = (totalFeet * 8) / 32;
                
                const costDrywall = sheets * pricePerSheet;
                const paint = (totalFeet * 8) / 400;
                const costPaint = paint * pricePerPaint;
                
                // Tally Categories
                let countElec = 0;
                let countPlumb = 0;
                let countHvac = 0;
                
                for(let p of countPoints) {
                    if (p.type === 'elec') countElec++;
                    else if (p.type === 'plumb') countPlumb++;
                    else if (p.type === 'hvac') countHvac++;
                }

                const totalCost = costDrywall + costPaint + 
                                  (countElec * costElecUnit) + 
                                  (countPlumb * costPlumbUnit) + 
                                  (countHvac * costHvacUnit);
                
                document.getElementById('display_feet').innerText = totalFeet.toFixed(2) + " ft";
                document.getElementById('display_cost').innerText = currencySym + totalCost.toFixed(2);
                
                document.getElementById('hidden_feet').value = totalFeet.toFixed(2);
                document.getElementById('hidden_cost').value = totalCost.toFixed(2);
                document.getElementById('hidden_sheets').value = sheets;
                document.getElementById('hidden_paint').value = paint;
                
                document.getElementById('hidden_currency').value = currencySym;
                document.getElementById('hidden_unit_sheet').value = pricePerSheet;
                document.getElementById('hidden_unit_paint').value = pricePerPaint;
                
                // Send specific counts and units
                document.getElementById('hidden_count_elec').value = countElec;
                document.getElementById('hidden_count_plumb').value = countPlumb;
                document.getElementById('hidden_count_hvac').value = countHvac;
                document.getElementById('hidden_unit_elec').value = costElecUnit;
                document.getElementById('hidden_unit_plumb').value = costPlumbUnit;
                document.getElementById('hidden_unit_hvac').value = costHvacUnit;
                
                checkFreeTrial();
            } catch(e) {}
        }
    </script>
</head>
<body onload="checkFreeTrial()">

    <div class="navbar">
        <a href="/" class="logo">Snap<span class="highlight">Takeoff</span></a>
    </div>

    {% if page == 'home' %}
        <div class="hero-band">
            <h1>AI Estimation for<br><span class="highlight">Modern Contractors</span></h1>
            <p>Upload your blueprint. Get instant material takeoffs and cost estimates. No complex software required.</p>
            <a href="/tool" class="btn-cta">GET STARTED</a>
        </div>
        <div class="container">
            <div class="features">
                <div class="feature-card">
                    <span class="feature-icon">üìÇ</span>
                    <div class="feature-title">1. Upload Blueprint</div>
                    <div class="feature-desc">Simply upload an image of your floor plan (JPG or PNG). No CAD files needed.</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">ü§ñ</span>
                    <div class="feature-title">2. AI Analysis</div>
                    <div class="feature-desc">Our intelligent sensor detects walls and calculates linear footage automatically.</div>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">üìä</span>
                    <div class="feature-title">3. Instant Excel</div>
                    <div class="feature-desc">Download a professional cost estimate and material list in seconds.</div>
                </div>
            </div>
            
             <div class="faq-section">
                <h2>Frequently Asked Questions</h2>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> How accurate is the estimation?</div>
                    <div class="faq-a">The accuracy depends on the image clarity and your calibration. If you set the "Real World Width" correctly, SnapTakeoff is typically accurate within 95-98% for linear footage.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> What file formats do you accept?</div>
                    <div class="faq-a">We accept standard image files like .JPG, .JPEG, and .PNG. If you have a PDF, please take a screenshot of the page you want to estimate and upload that.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> Is my payment information secure?</div>
                    <div class="faq-a">Yes. We use Razorpay, a banking-grade payment processor. We do not store your card details on our servers.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-q"><span class="highlight">?</span> Can I customize material prices?</div>
                    <div class="faq-a">Absolutely. After scanning, you can enter your own local prices for Drywall Sheets and Paint to get an exact quote for your specific job.</div>
                </div>
            </div>
            <div class="footer">
                <p>Have questions? Email us at <a href="mailto:filehangar2025@gmail.com">filehangar2025@gmail.com</a></p>
                <p style="opacity: 0.7; margin-top: 10px;">&copy; 2024 SnapTakeoff Inc.</p>
            </div>
        </div>
    {% endif %}

    {% if page == 'tool' %}
        <div class="container">
            <h1 class="page-title">Upload Blueprint.</h1>
            
            <div class="info-section">
                <h2>Controls Guide</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">‚ö°</span> Sensitivity</div>
                        <div class="info-body">Lower = More sensitive (detects faint lines). Higher = Less sensitive (bold lines only).</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üåâ</span> Gap Fill</div>
                        <div class="info-body">Connects broken lines. Increase this to jump gaps like doorways.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üßπ</span> Min Wall Length</div>
                        <div class="info-body">Noise filter. Ignores small specks, text, or furniture.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-head"><span class="highlight">üìè</span> Wall Thickness</div>
                        <div class="info-body">Visual only. Makes the red lines thicker for easier viewing.</div>
                    </div>
                    <div class="info-card" style="grid-column: 1 / -1;">
                        <div class="info-head"><span class="highlight">üéØ</span> Calibration</div>
                        <div class="info-body">Enter the total image width OR use the <b>'Calibrate Scale'</b> button below to measure a known distance (like a 3ft door) for perfect accuracy.</div>
                    </div>
                </div>
            </div>

            <div class="box-dark">
                <h2>// SENSOR CONFIGURATION</h2>
                <form action="/tool" method="post" enctype="multipart/form-data">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <div class="slider-container"><label class="slider-label">Sensitivity</label><div class="slider-row"><input type="range" id="range_thresh" name="thresh" min="20" max="200" value="{{ params.thresh }}" oninput="syncInputs('range_thresh', 'num_thresh')"><input type="number" id="num_thresh" min="20" max="200" value="{{ params.thresh }}" oninput="syncInputs('num_thresh', 'range_thresh')"></div></div>
                            <div class="slider-container"><label class="slider-label">Min Wall Length</label><div class="slider-row"><input type="range" id="range_len" name="min_len" min="50" max="500" value="{{ params.min_len }}" oninput="syncInputs('range_len', 'num_len')"><input type="number" id="num_len" min="50" max="500" value="{{ params.min_len }}" oninput="syncInputs('num_len', 'range_len')"></div></div>
                        </div>
                        <div>
                            <div class="slider-container"><label class="slider-label">Gap Fill</label><div class="slider-row"><input type="range" id="range_gap" name="gap" min="5" max="100" value="{{ params.gap }}" oninput="syncInputs('range_gap', 'num_gap')"><input type="number" id="num_gap" min="5" max="100" value="{{ params.gap }}" oninput="syncInputs('num_gap', 'range_gap')"></div></div>
                            <div class="slider-container"><label class="slider-label">Wall Thickness</label><div class="slider-row"><input type="range" id="range_thick" name="thick" min="1" max="10" value="{{ params.thick }}" oninput="syncInputs('range_thick', 'num_thick')"><input type="number" id="num_thick" min="1" max="10" value="{{ params.thick }}" oninput="syncInputs('range_thick', 'num_thick')"></div></div>
                        </div>
                    </div>
                    <hr>
                    <div style="margin-bottom: 20px;">
                        <label for="file-upload" class="custom-file-upload">üìÇ CLICK TO SELECT BLUEPRINT</label>
                        <input id="file-upload" type="file" name="file" required onchange="updateFileName(this)">
                        <span id="file-name-text" class="file-name-display">No file chosen yet.</span>
                    </div>
                    <button type="submit" class="btn-upload">INITIATE SCAN</button>
                </form>
            </div>

            {% if result %}
            <input type="hidden" id="raw_pixels_store" value="{{ raw_pixels }}">
            <input type="hidden" id="raw_width_store" value="{{ raw_width }}">

            <div class="box-dark">
                <h2 style="color: #FFC107;">// ANALYSIS COMPLETE</h2>
                <div class="results-grid">
                    <div>
                        <canvas id="blueprintCanvas" style="width: 100%; border-radius: 8px;"></canvas>
                        
                        <div class="tool-row">
                            <button id="btnScaleMode" class="btn-tool-toggle" onclick="setMode('scale')">üìè CALIBRATE</button>
                            <button id="btnAreaMode" class="btn-tool-toggle" onclick="setMode('area')">üìê AREA</button>
                            
                            <button id="btnCountMode" class="btn-tool-toggle" onclick="setMode('count')">üëÜ COUNT</button>
                            <select id="catSelector" class="cat-select hidden" onchange="updateCategory()">
                                <option value="elec">‚ö° Elec</option>
                                <option value="plumb">üöø Plumb</option>
                                <option value="hvac">‚ùÑÔ∏è HVAC</option>
                            </select>

                            <button id="btnLoupeToggle" class="btn-tool-toggle active" onclick="toggleLoupe()">üîç ZOOM: ON</button>
                            <button class="btn-tool-toggle btn-tool-clear" onclick="clearTools()">üóëÔ∏è RESET</button>
                        </div>
                    </div>
                    <div>
                        <div class="metric-box">
                            <div class="metric-label" style="color: #FFC107; font-weight:bold;">REAL WORLD WIDTH (FT)</div>
                            <input type="number" id="real_width_input" class="calib-input" value="50" oninput="recalc()">
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div class="metric-box">
                                <div class="metric-label">COST/SHEET</div>
                                <input type="number" id="cost_sheet" class="calib-input" value="15" oninput="recalc()">
                            </div>
                            <div class="metric-box">
                                <div class="metric-label">COST/PAINT</div>
                                <input type="number" id="cost_paint" class="calib-input" value="40" oninput="recalc()">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2px; margin-bottom: 10px;">
                            <div class="metric-box-compact">
                                <div class="metric-label" style="font-size: 10px;">‚ö° ELEC</div>
                                <input type="number" id="cost_elec" class="calib-input-compact" value="5" oninput="recalc()">
                            </div>
                            <div class="metric-box-compact">
                                <div class="metric-label" style="font-size: 10px;">üöø PLUMB</div>
                                <input type="number" id="cost_plumb" class="calib-input-compact" value="150" oninput="recalc()">
                            </div>
                            <div class="metric-box-compact">
                                <div class="metric-label" style="font-size: 10px;">‚ùÑÔ∏è HVAC</div>
                                <input type="number" id="cost_hvac" class="calib-input-compact" value="80" oninput="recalc()">
                            </div>
                        </div>

                        <div class="metric-box" style="margin-bottom: 10px;">
                            <div class="metric-label">CURRENCY</div>
                            <select id="currency_select" class="calib-input" style="width: 100%;" onchange="recalc()">
                                <option value="$">USD ($)</option>
                                <option value="‚Çπ">INR (‚Çπ)</option>
                                <option value="‚Ç¨">EUR (‚Ç¨)</option>
                                <option value="¬£">GBP (¬£)</option>
                                <option value="SAR ">SAR (Ô∑º)</option>
                                <option value="AED ">AED (ÿØ.ÿ•)</option>
                                <option value="C$">CAD (C$)</option>
                                <option value="A$">AUD (A$)</option>
                            </select>
                        </div>

                        <div class="metric-box"><div class="metric-val" id="display_feet">---</div><div class="metric-label">TOTAL LINEAR FEET</div></div>
                        <div class="metric-box"><div class="metric-val" id="display_area">---</div><div class="metric-label">FLOOR AREA</div></div>
                        <div class="metric-box"><div class="metric-val" id="display_count">---</div><div class="metric-label">ITEMS COUNTED</div></div>

                        <div class="metric-box"><div class="metric-val" id="display_cost">---</div><div class="metric-label">ESTIMATED COST</div></div>
                        
                        <form id="download_form" action="/download_report" method="post">
                            <input type="hidden" name="final_feet" id="hidden_feet">
                            <input type="hidden" name="final_cost" id="hidden_cost">
                            <input type="hidden" name="final_sheets" id="hidden_sheets">
                            <input type="hidden" name="final_paint" id="hidden_paint">
                            <input type="hidden" name="final_area" id="hidden_area" value="0">
                            
                            <input type="hidden" name="currency_symbol" id="hidden_currency">
                            <input type="hidden" name="unit_price_sheet" id="hidden_unit_sheet">
                            <input type="hidden" name="unit_price_paint" id="hidden_unit_paint">
                            
                            <input type="hidden" name="count_elec" id="hidden_count_elec" value="0">
                            <input type="hidden" name="count_plumb" id="hidden_count_plumb" value="0">
                            <input type="hidden" name="count_hvac" id="hidden_count_hvac" value="0">
                            
                            <input type="hidden" name="unit_elec" id="hidden_unit_elec" value="0">
                            <input type="hidden" name="unit_plumb" id="hidden_unit_plumb" value="0">
                            <input type="hidden" name="unit_hvac" id="hidden_unit_hvac" value="0">
                            
                            <button type="button" id="btn-free" onclick="useFreeTrial()" class="btn-free">
                                üéÅ UNLOCK FOR FREE (1 TIME ONLY)
                            </button>

                            <button type="button" onclick="startPayment()" class="btn-pay">
                                Unlock & Download Excel File (199/-)
                            </button>
                        </form>

                    </div>
                </div>
            </div>
            <script>
                initCanvas("{{ image_data }}");
                recalc();
            </script>
            {% endif %}
        </div>
    {% endif %}
</body>
</html>